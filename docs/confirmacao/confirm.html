<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Confirmação de Email</title>
    <style>
      body {
        font-family: system-ui, -apple-system, "Segoe UI", Roboto, Helvetica,
          Arial;
        background: #f7f8fb;
        color: #111;
        display: flex;
        align-items: center;
        justify-content: center;
        height: 100vh;
        margin: 0;
      }
      .card {
        background: #fff;
        padding: 24px;
        border-radius: 12px;
        box-shadow: 0 6px 18px rgba(20, 20, 40, 0.06);
        width: 100%;
        max-width: 480px;
      }
      h1 {
        font-size: 20px;
        margin: 0 0 12px;
      }
      p {
        margin: 8px 0;
      }
      .muted {
        color: #666;
        font-size: 13px;
      }
      .success {
        color: #0a8a0a;
      }
      .error {
        color: #c22;
      }
      a.button {
        display: inline-block;
        margin-top: 12px;
        padding: 10px 14px;
        background: #005faf;
        color: #fff;
        border-radius: 8px;
        text-decoration: none;
      }
    </style>
  </head>
  <body>
    <div class="card">
      <h1>Confirmação de email</h1>
      <div id="info" class="muted">Verificando...</div>
      <div id="result"></div>
      <a id="loginLink" class="button" style="display: none" href="#"
        >Ir para login</a
      >
    </div>

    <script>
      // Substitua pela URL do seu projeto Supabase
      const SUPABASE_URL = "https://nzepugdxycwzdyticxpr.supabase.co";

      const info = document.getElementById("info");
      const result = document.getElementById("result");
      const loginLink = document.getElementById("loginLink");

      function getQueryParam(name) {
        const params = new URLSearchParams(window.location.search);
        return params.get(name);
      }

      const accessToken =
        getQueryParam("access_token") || getQueryParam("token");
      const type = getQueryParam("type");

      async function verifyToken(token) {
        try {
          const res = await fetch(`${SUPABASE_URL}/auth/v1/user`, {
            method: "GET",
            headers: { Authorization: `Bearer ${token}` },
          });
          if (!res.ok) {
            const body = await res.json().catch(() => ({}));
            throw new Error(body?.message || "Token inválido ou expirado");
          }
          const body = await res.json().catch(() => ({}));
          return body;
        } catch (e) {
          throw e;
        }
      }

      (async function () {
        if (!accessToken) {
          info.textContent = "Link inválido. Nenhum token encontrado.";
          info.className = "muted error";
          return;
        }

        // Só para informação: o tipo costuma ser 'signup' ou 'recovery'
        info.textContent = "Verificando token...";

        try {
          await verifyToken(accessToken);
          info.textContent = "Email confirmado com sucesso.";
          info.className = "muted success";
          result.innerHTML =
            '<p class="success">Sua conta foi confirmada. Agora você pode entrar.</p>';
          loginLink.style.display = "inline-block";
          // ajuste o link de login se necessário
          loginLink.href = "/";
        } catch (e) {
          info.textContent = "Não foi possível confirmar o email.";
          info.className = "muted error";
          result.innerHTML = `<p class="error">${
            e?.message || "Token inválido ou expirado."
          }</p>`;
          loginLink.style.display = "inline-block";
          loginLink.href = "/";
        }
      })();
    </script>
  </body>
</html>
